# Тесты

## Структура

- [x] tests/test_storage.py
    - [x] TestInMemoryStorage
        - [x] Тест базовой операции set и get
        - [x] Тест получения несуществующего ключа
        - [x] Тест перезаписи значения
        - [x] Тест удаления существующего ключа
        - [x] Тест удаления несуществующего ключа
        - [x] Тест получения всех данных из пустого хранилища
        - [x] Тест получения всех данных с несколькими элементами
        - [x] Тест что get_all_data возвращает копию, а не ссылку
        - [x] Тест загрузки пустых данных
        - [x] Тест загрузки данных с несколькими элементами
        - [x] load_data должна заменять существующие данные
        - [x] load_data должна создавать копию переданных данных
        - [x] Тест хранения различных типов данных
        - [x] Тест последовательности множественных операций
        - [x] Тест работы с пустой строкой в качестве ключа

- [x] tests/test_wal.py
    - [x] TestFileWal
        - [x] Тест логирования одной операции
        - [x] Тест логирования нескольких операций
        - [x] Тест воспроизведения пустого WAL
        - [x] Тест воспроизведения несуществующего файла
        - [x] Тест очистки WAL
        - [x] Тест логирования после очистки WAL
        - [x] Тест автоматического создания файла и директории

- [x] tests/test_persistence.py
    - [x] TestSnapshotter
        - [x] Тест сохранения простых данных
        - [x] Тест загрузки существующего снапшота
        - [x] Тест загрузки несуществующего снапшота
        - [x] Тест сохранения пустых данных
        - [x] Тест сохранения сложных структур данных
        - [x] Тест сохранения данных с Unicode символами
        - [x] Тест перезаписи существующего файла
        - [x] Тест автоматического создания директории
        - [x] Тест загрузки поврежденного JSON файла
        - [x] Тест множественных циклов сохранения и загрузки
        - [x] Тест сохранения большого объема данных
        - [x] Тест сохранения специальных символов
        - [x] Тест сохранения None значений

- [x] tests/test_database.py
    - [x] TestKVDB
        - [x] Тест базовых операций set и get
        - [x] Тест получения несуществующего ключа
        - [x] Тест удаления существующего ключа
        - [x] Тест удаления несуществующего ключа
        - [x] Тест логирования операций в WAL
        - [x] Тест автоматического создания снапшота при достижении порога
        - [x] Тест персистентности данных между перезапусками
        - [x] Тест воспроизведения WAL при инициализации
        - [x] shutdown должен создавать финальный снапшот
        - [x] Тест перезаписи значения
        - [x] Тест работы со сложными типами данных
        - [x] Тест последовательности множественных операций
        - [x] Cчетчик операций должен сбрасывается после снапшота
        - [x] Тест работы с threshold снапшота равным 1
        - [x] Тест большого количества операций
        - [x] Тест сценария восстановления после сбоя

- [x] tests/test_collection.py
    - [x] TestCollection
        - [x] Тест базовых операций set и get в коллекции
        - [x] Тест получения несуществующего ключа из коллекции
        - [x] Тест удаления из коллекции
        - [x] Тест удаления несуществующего ключа
        - [x] Тест подсчета элементов в пустой коллекции
        - [x] Тест подсчета элементов в коллекции
        - [x] Тест проверки существования ключа
        - [x] Тест получения всех данных из пустой коллекции
        - [x] Тест получения всех данных из коллекции
        - [x] Тест изоляции между различными коллекциями
        - [x] Тест использования одинаковых ключей в разных коллекциях
        - [x] Ключи хранятся с префиксом в базе данных
        - [x] Тест перезаписи значения в коллекции
        - [x] Удаление обновляет счетчик
        - [x] Тест работы с пустым именем коллекции
        - [x] Тест хранения сложных вложенных данных
        - [x] Тест персистентности данных коллекции
        - [x] Тест персистентности нескольких коллекций

- [x] tests/test_extra.py
    - [x] TestUnusualScenarios
        - [x] Тест работы с очень длинным ключом
        - [x] Тест работы с очень большим значением
        - [x] Тест работы с глубоко вложенной структурой данных
        - [x] Тест что списки с циклическими ссылками вызывают ошибку при сериализации
        - [x] Тест специальных граничных случаев JSON
        - [x] Тест ключей с двоеточием внутри коллекции
        - [x] Тест имени коллекции с несколькими двоеточиями
        - [x] Тест чередующихся операций set и delete на одном ключе
        - [x] Тест ключей состоящих только из пробелов
        - [x] Тест строк похожих на бинарные данные
        - [x] Тест работы с очень большим количеством коллекций
        - [x] Тест пустого снапшота с операциями в WAL
        - [x] Тест get_all с большим количеством элементов
        - [x] Тест быстрых циклов shutdown/restart
        - [x] Тест с нулевым threshold снапшота (граничный случай)

## Покрытие

```
Name                      Stmts   Miss  Cover
---------------------------------------------
app\core\__init__.py          7      0   100%
app\core\collection.py       41      2    95%
app\core\database.py         67      0   100%
app\core\interfaces.py       64     19    70%
app\core\persistence.py      25      4    84%
app\core\storage.py          18      0   100%
app\core\wal.py              37      5    86%
---------------------------------------------
TOTAL                       259     30    88%
```